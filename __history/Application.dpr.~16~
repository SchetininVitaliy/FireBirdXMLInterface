program Application;

{$APPTYPE CONSOLE}

{$R *.res}

uses
  System.SysUtils,
  FireBird2XML_COM_TLB in '..\Embarcadero\Studio\16.0\Imports\FireBird2XML_COM_TLB.pas',
  XMLDoc,
  XMLIntf,
  Variants,
  Data.DB, IBX.IBDatabase, IBX.IBQuery, IBX.IBCustomDataSet,
  SQLTable in 'SQLTable.pas',
  SQLTableCreator in 'SQLTableCreator.pas',
  XMLSQLTableCreator in 'XMLSQLTableCreator.pas';

var
  xmlCreator:TXMLSQLTableCreator;
  sqlTable:TSQLTable;
  ibds: TIBDataSet ;
  ibdb: TIBDatabase;
  query: TIBQuery;
  trans: TIBTransaction;

  dataSource : TDataSource;
  rec : integer;
begin
  xmlCreator := TXMLSQLTableCreator.Create();
  sqlTable:=TSQLTable.Create;
  xmlCreator.CreateTableFromXML('table1.xml',sqlTable);
  sqlTable.Print();
  xmlCreator.Destroy;

  xmlCreator := TXMLSQLTableCreator.Create();
  xmlCreator.CreateXMLFromTable('table2.xml',sqlTable);
  xmlCreator.Destroy;

  ibdb :=  TIBDatabase.Create(nil);
  ibdb.Params.Clear;
  ibdb.LoginPrompt:=False;
  ibdb.DatabaseName:='C:\Users\vitaliy\Documents\TEST.FDB';
  ibdb.Params.Add('user_name=SYSDBA');
  ibdb.Params.Add('password=masterkey');
  ibdb.Params.Add('lc_ctype=utf8');
  ibdb.Connected:=True;
  //todo обработка исключений
  trans := TIBTransaction.Create(nil);
  query := TIBQuery.Create(nil);
  trans.DefaultDatabase := ibdb;
  //query.Database := ibdb;
  //query.Transaction := trans;

  dataSource := TDataSource.Create(nil);
  dataSource.DataSet := query;

  ibds := TIBDataSet.Create(nil);
  ibds.Database := ibdb;
  ibds.Transaction := trans;
  ibds.SelectSQL.Text := 'select * from NEW_TABLE';

  ibdb.Open();
  trans.StartTransaction;
  //ibds.Active := true;

  rec := ibds.FieldCount;
end.
